#!/bin/bash
echo "deb http://mirror.xivo.io/debian/ xivo-five main" >> /etc/apt/sources.list
wget http://mirror.xivo.io/xivo_current.key -O - | apt-key add -
apt-get update
apt-get -qq -y install wget apt-utils python-pip git ssh libpq-dev python-dev libsasl2-dev libldap2-dev nginx xivo-config xivo-lib-python net-tools
cd /root
git clone git://github.com/xivo-pbx/xivo-dird
cd xivo-dird
git checkout -t origin/async-plugin
pip install -r requirements.txt
python setup.py install
touch /var/log/xivo-dird.log
cp debian/xivo-dird.init /etc/init.d/xivo-dird
mkdir /etc/xivo/xivo-dird
mkdir /var/run/xivo-dird/
chown www-data /var/run/xivo-dird/
chown www-data /var/log/xivo-dird.log
cp -a examples/xivo-dird.conf examples/plugins.d /etc/xivo/xivo-dird
cp examples/xivo-dird.nginx /etc/nginx/sites-available/xivo-dird
service nginx restart
apt-get clean
/usr/local/bin/xivo-dird -u www-data
